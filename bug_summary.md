# btcusd-ml-predictorのバグと問題点まとめ

## 1. 目標変数（target variables）の欠落

### 問題の詳細:
- `target_smoothed_change_1/2/3` や `target_binary_1/2/3` などの基本的な目標変数が見つからない
- これらの目標変数はデータフレームのカラムに存在していない
- 特徴量選択処理（feature_selector.py）でこれらの変数が必要とされている

### 影響範囲:
- 特徴量と目標変数の準備（prepare_features）が正しく完了できない
- 後続の処理（モデルトレーニングなど）に影響を与える

### 原因:
- データ処理段階で目標変数が生成されていない可能性がある
- 生成されているが命名規則が異なっている可能性がある
- CSVファイルに必要なカラムが存在しない可能性がある

## 2. 二値分類モデルのファイル欠落

### 問題の詳細:
- `binary_classification_model_period_1.joblib` などのモデルファイルが見つからない
- 対応する目標変数 `binary_classification_1/2/3` も見つからない

### 影響範囲:
- モデル評価（evaluate_models）が正しく実行できない
- 予測に必要なモデルがないため、正確な予測ができない

### 原因:
- モデルトレーニングが実行されていない可能性がある
- トレーニングに失敗している可能性がある
- モデルが別のパスに保存されている可能性がある

## 3. 高閾値シグナル変数の欠落

### 問題の詳細:
- 高閾値シグナル変数（`target_high_threshold_*`）が見つからない
- `data_splitter.py` がダミーの高閾値シグナル変数を生成している
- これらのダミー変数による評価は「正確ではない」と警告が出ている

### 影響範囲:
- 高閾値シグナルに基づくトレーディング戦略の評価が不正確になる
- 高閾値モデルの適合率や効率性の評価が不正確になる

### 原因:
- 高閾値シグナル変数を生成するステップが実行されていない
- 生成処理（fix_high_threshold_signals.py）に問題がある可能性がある
- 入力データが不十分で高閾値シグナルが計算できない可能性がある

## 4. 修正処理の問題点

### 問題の詳細:
- `fix_high_threshold_signals.py` が期待通りに機能していない可能性がある
- 高閾値シグナル変数の生成に必要な基本ターゲット変数が見つからない
- 有効なターゲット列の特定に問題がある可能性がある

### 影響範囲:
- システムの自動修復機能が効果的に動作していない
- 複数回の警告が継続して表示される

### 原因:
- データフォーマットが想定と異なる
- 期待される列名と実際の列名の不一致
- 修正処理の実装ミスの可能性

## 5. データスプリッターの問題点

### 問題の詳細:
- テストデータ準備時（prepare_test_data）に高閾値シグナル変数が見つからない
- ダミー変数生成による評価の正確性に問題がある

### 影響範囲:
- モデル評価の正確性に影響を与える
- パイプライン全体の結果の信頼性に影響を与える

### 原因:
- データ準備プロセスの不整合
- 必要なデータ変換や前処理の欠落

## 6. 実行フローの問題

### 問題の詳細:
- 同じエラーが再実行時に繰り返し発生している
- データ前処理、モデルトレーニング、評価の連携に問題がある可能性がある

### 影響範囲:
- パイプライン全体が効果的に機能していない
- 何度実行しても同じエラーが解決されない

### 原因:
- エラー処理とリカバリーメカニズムの問題
- データとモデルの依存関係の管理の不適切さ

## 7. システム設計上の考察

### 問題の詳細:
- システムは欠落した変数やモデルに対して自動的に生成や代替処理を試みようとしているが、十分に機能していない
- ダミーデータや代替処理による評価は明示的に「正確ではない」と警告している

### 影響範囲:
- システムの頑健性と信頼性
- ユーザー体験とシステムの使いやすさ

### 原因:
- エラー処理とフォールバックメカニズムの設計に改善の余地がある
- パイプラインの各ステップの依存関係の管理に問題がある可能性がある

## 修正の優先順位

1. **基本目標変数の生成修正**: 最も基本的な目標変数（target_smoothed_change_*やtarget_binary_*）が正しく生成されるようにする
2. **高閾値シグナル変数の生成修正**: 高閾値シグナル変数が正しく生成されるように処理を修正する
3. **モデルトレーニングフローの修正**: 必要なモデルが正しくトレーニングされ保存されるようにする
4. **エラー処理の改善**: エラー発生時の適切なフォールバックとリカバリー処理を実装する
5. **パイプライン全体の依存関係見直し**: 各ステップの依存関係とデータフローを見直し、整合性を確保する
